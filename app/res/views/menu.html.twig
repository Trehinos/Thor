<ul>
    {% for item in menu %}
        {% set is_group = item.group is defined %}
        <li class="d-flex mb-1">
            <button
                    id="btn-{{ item.route }}"
                    onclick="menuClick(this);"
                    data-url="{% if item.route != '.' %}{{ url(item.route) }}{% else %}#{% endif %}"
                    data-item="{{ item.route }}"
                    class="flex-fill {% if server.currentRouteName == item.route %}selected{% endif %}"
            >
                {{ icon(item.icon, 'mr-2 fa-lg ' ~ (item.icon_col ?? 'fas'), true) }}
                {{ DICT.menu[item.label] ?? item.label ?? '' }}
            </button>
            {% if is_group %}
                {% for sub_item in item.group %}
                    <button
                            onclick="menuClick(this);"
                            data-url="{% if sub_item.route != '.' %}{{ url(sub_item.route) }}{% else %}#{% endif %}"
                            title="{{ DICT.menu[sub_item.label] ?? sub_item.label ?? '' }}"
                            {% if server.currentRouteName == sub_item.route %}class="selected"{% endif %}
                    >
                        {{ icon(sub_item.icon, 'fa-lg ' ~ (sub_item.icon_col ?? 'fas'), true) }}
                    </button>
                {% endfor %}
            {% endif %}
        </li>
    {% endfor %}
</ul>
<script>

    function unselect($elem) {
        $elem.classList.remove("selected")
    }

    function menuClick($elem) {
        let url = $elem.dataset.url;
        $$each("#menu ul li button", unselect);
        loadPage(url, null, (response) => {
            $$each("#menu ul li button", unselect);
            $elem.classList.add("selected");
            window.history.pushState({"html": response}, null, "?menuItem=" + $elem.data("item"));
        });
    }
</script>